<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: SodaCore/frameworks/instruments/index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: SodaCore/frameworks/instruments/index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module Instruments
 * @description The iOS Instruments framework for the Soda Test Engine
 */

module.exports = function (soda) {
    "use strict";
    var fs        = require("fs"),
        path      = require("path"),

        /**
         * @associates InstrumentsConfiguration
         */
        iconfig   = require(path.join(__dirname, 'imports', 'Config')),

        spawn     = require("child_process").spawn,
        exec      = require("child_process").exec,
        nodePath  = require('path'),
        /**
         * @composes InstrumentsDriver
         * @type Instruments
         */
        driver = new (require("./imports/Driver.js"))(soda),
        /**
         * @composes Tree
         */
        Tree = new (require("./imports/Tree.js"))(),

        /**
         * @composes Perfecto/ElementInteractions
         */
        elementInteractions = new (require("./imports/ElementInteractions.js"))(soda, driver),

        Instruments;

    /**
     * The instruments framework driver for Soda
     * @constructor
     */
    Instruments = function (soda) {
        var self     = this,
            appName = null,
            bundleIdentifier = null,
            isSimulator = null,
            instance = {
                process: null,
                running: false
            };

        // Yes, these are required...
        this.name     = "Instruments";
        this.platform = "iOS";
        this.version  = "1.0";

        this.defaultSyntaxVersion = "2.0";
        this.defaultSyntaxName = "mobile";

        /**
         * Launch an Instruments process
         * @param {object} device The simulator object as passed from Instruments.findDevice
         * @param {string} template The path to the Instruments template path
         * @param {string} app The app to launch
         * @param {function} complete A callback for completion
         */
        function launch (device, complete) {
            var err = arguments.sodaexpect("object", "function|undefined").error;
            if(err) throw err;

            var destination = "platform=iOS Simulator,id=" + device.udid;

            if (!device.isSimulator) {
                destination = "id=" + device.udid;

                exec(
                    "pkill mobiledevice",

                    function () {
                      var margs = [
                        "tunnel",
                        "8100",
                        "8100"
                      ];
                      var mobiledevice = spawn(path.resolve(path.join(__dirname, "..", "..", "..", "mobiledevice")) + '/mobiledevice', margs);

                      mobiledevice.stderr.on('data', function (data) {
                          soda.console.error(data.toString('utf-8'));
                      });

                      mobiledevice.stdout.on('data', function (data) {
                          soda.console.verbose(data.toString('utf-8'));
                      });
                    }
                );
            }
            else {
              exec(
                  "pkill mobiledevice",

                  function () {
                    console.log("Attempted to kill tunnel");
                  });
            }

            var args = [ // The arguments send to the instruments command
                    "-project",
                    path.resolve(path.join(__dirname, "..", "..", "..", "WebDriverAgent", "WebDriverAgent.xcodeproj")),
                    "-scheme",
                    "WebDriverAgentRunner",
                    "-destination",
                    destination,
                    "test"
                ];

            console.log("Booting device (this may take a moment)...", args);
            exec(
                "pkill xcodebuild\n"                                                                         +
                ((device['isSimulator'] &amp;&amp; soda.config.get("resetDevice")) ?
                    "xcrun simctl erase " + device + "\n" : ""
                ),

                function () {
                    setTimeout(function () {
                        var xbuild = spawn("xcodebuild", args);

                        xbuild.stderr.on('data', function (data) {
                            soda.console.error(data.toString('utf-8'));
                        });

                        xbuild.stdout.on('data', function (data) {
                            soda.console.verbose(data.toString('utf-8'));
                        });

                        complete.call(self, null, xbuild);
                    }, 3000);
                }
            );
        }

        /**
         * Installs an application on a device
         * @param {object} bundleId The bundle identifier
         * @param {string} appPath The path to the application
         * @param {function} complete A callback for completion
         */
        function installApp(bundleId, appPath, complete) {
            driver.installApp(bundleId, appPath, complete);
        }

        /**
         * Gets the tree for the current screen displayed on the device
         * @param {function} complete A callback for completion
         */
        function getTree(complete) {
            driver.getSourceTree(complete);
        }

        /**
         * Gets the orientation of the device
         * @param {function} complete A callback for completion
         */
        function getOrientation(complete) {
            driver.getOrientation(complete);
        }

        /**
         * Gets the bounds for the current screen displayed on the device
         * @param {function} complete A callback for completion
         */
        function getScreenBounds(complete) {
            driver.getScreenBounds(complete);
        }

        /**
         * Uploads an application to the device and installs it
         * @param {string} simulatorOrDevice The name of the simulator or device
         * @param {object} bundleId The bundle identifier
         * @param {string} appPath The path to the application
         * @param {function} complete A callback for completion
         */
        function uploadToDevice(simulatorOrDevice, bundleId, appPath, complete) {
          self.findDevice(simulatorOrDevice, function (err, device, available) {
              if(available &amp;&amp; typeof available === "object") {
                soda.console.debug("Found device: " + simulatorOrDevice, device);
                soda.config.set("deviceid", device['udid']);
                soda.config.set("findElementRetries", 15);

                launch(device, function (err, instruments) {
                  if (err) {
                    complete.call(self, err, false);
                  }

                  var gotStatus      = false,
                      initInterval, initTimeout;

                  // Set an interval to emit when ready...
                  initInterval = setInterval(function () {
                      if(gotStatus) {
                          console.log("Framework Ready");
                      }
                      else {
                        console.log("Framework Not Ready");

                        driver.status(function (err, result) {
                            if (result) {
                              gotStatus = true;
                              clearTimeout(initTimeout);
                              clearInterval(initInterval);

                              installApp(bundleId, appPath, function(err, sessionId) {
                                if(err) {
                                    soda.console.error(err.message);
                                    if(complete instanceof Function) complete.call(self, err, false);
                                    return;
                                }

                                isSimulator = device.isSimulator;

                                console.log("Framework Started with sessionId:", sessionId);

                                complete.call(self, err, true);
                              });
                            }
                        });
                      }
                  }, 10000);

                  // Set a timeout, jic the interval fails
                  initTimeout = setTimeout(function () {
                      clearInterval(initInterval);

                      complete.call(self, new Error("Framework timed out."), false);
                  }, iconfig.INIT_TIMEOUT);
                });
              }
              else {
                  complete.call(self, new Error("Could not find device you are looking for."), false);
              }
          });
        }

        /**
         * Builds an XCode Project or WorkSpace and installs it onto target simulator.
         * @param {string} simulatorOrDevice The name of the simulator or device
         * @param {string} target The XCode target to be built
         * @param {string} projectOrWorkSpace The full path to the xcodeproj or xcworkspace file
         * @param {string} buildPath The path where the app will be built to
         * @param {string} appName The name of the application
         * @param {object} bundleId The bundle identifier
         * @param {object} deviceToDeploy The device to deploy the application to
         * @param {function=} complete A callback for completion
         */
        this.build = function (simulatorOrDevice, target, projectOrWorkSpace, buildPath, appName, bundleId, deviceToDeploy, complete) {
            var a = arguments.sodaexpect("string", "string", "string", "string", "string", "string", "string", "function|undefined"), err;

            if (soda.config.get("platform").toLowerCase() === "iphone" || soda.config.get("platform").toLowerCase() === "ipad") {
              var projectOrWorkSpaceFlag = (projectOrWorkSpace.indexOf('.xcworkspace') > 0) ? "-workspace" : "-project";

              if(a.error) {
                  switch(a.number) {
                      case 0:
                          err = new soda.exception.InvalidArgumentsError("Instruments.build is missing argument #" + a.number + ": `simulatorOrDevice`");
                          break;

                      case 1:
                          err = new soda.exception.InvalidArgumentsError("Instruments.build is missing argument #" + a.number + ": `target`");
                          break;

                      case 2:
                          err = new soda.exception.InvalidArgumentsError("Instruments.build is missing argument #" + a.number + ": `project or workspace`");
                          break;

                      case 3:
                          err = new soda.exception.InvalidArgumentsError("Instruments.build is missing argument #" + a.number + ": `buildPath`");
                          break;

                      case 4:
                          err = new soda.exception.InvalidArgumentsError("Instruments.build is missing argument #" + a.number + ": `appName`");
                          break;

                      case 5:
                          err = new soda.exception.InvalidArgumentsError("Instruments.build is missing argument #" + a.number + ": `bundleId`");
                          break;
                      case 6:
                          err = new soda.exception.InvalidArgumentsError("Instruments.build is missing argument #" + a.number + ": `deviceToDeploy`");
                          break;
                      case 7:
                          err = new soda.exception.InvalidArgumentsError("Instruments.build is missing argument #" + a.number + ": `complete`");
                          break;
                  }
              }

              if(err) {
                  if(complete instanceof Function) {
                      complete.call(self, false);
                  }
                  else {
                      throw err;
                  }
              }

              exec("rm -rf " + buildPath + '/' + target + '.*', function (err, stdout, stderr) {
                  if(err)    throw err;
                  if(stderr) throw new Error(stderr);

                  self.findDevice(simulatorOrDevice, function (err, device) {

                    if(err) {
                        soda.console.error(err.message);
                        if(complete instanceof Function) complete.call(self, 1);
                        return;
                    }

                    if(device) {
                        var type = 'iOS Simulator';
                        var buildSetting = "iphonesimulator" + device.runtime;
                        switch(true) {
                            case /Apple TV/g.test(device.name):
                                type = "tvOS";
                                break;

                            case device.isSimulator === false:
                                type = "iOS";
                                buildSetting = "iOS";
                                break;
                        }

                        var xbuild;

                        if (buildSetting === 'iOS') {
                          xbuild = spawn("xcodebuild", [
                              "-scheme",
                              target,
                              projectOrWorkSpaceFlag,
                              projectOrWorkSpace,
                              "-configuration",
                              "Debug",
                              "clean",
                              "build",
                              "CONFIGURATION_BUILD_DIR=" + buildPath,
                              "-destination",
                              "generic/platform=" + type + ",id=" + device.udid
                          ]);
                        }
                        else {
                          xbuild = spawn("xcodebuild", [
                              "-scheme",
                              target,
                              projectOrWorkSpaceFlag,
                              projectOrWorkSpace,
                              "-sdk",
                              buildSetting,
                              "-configuration",
                              "Debug",
                              "clean",
                              "build",
                              "CONFIGURATION_BUILD_DIR=" + buildPath,
                              "-destination",
                              "platform=" + type + ",name=" + device.name
                          ]);
                        }


                        if(xbuild &amp;&amp; xbuild.stderr &amp;&amp; xbuild.stdout) {
                            xbuild.stderr.on('data', function (data) {
                                soda.console.error(data.toString('utf-8'));
                            });

                            xbuild.stdout.on('data', function (data) {
                                soda.console.verbose(data.toString('utf-8'));
                            });

                            xbuild.on('close', function (code) {
                              if (code !== 0) complete(new Error("Unsuccessful build."), false);

                              var appPath = appName;

                              if (appPath.indexOf('.app') &lt; 0) {
                                appPath = buildPath + '/' + appName + '.app';
                              }

                              uploadToDevice(deviceToDeploy, bundleId, appPath, function(err, result) {
                                complete.call(self, true);
                              });
                            });
                        }
                        else {
                            soda.console.error("Error spawning `xcodebuild`");
                            if(complete instanceof Function) complete.call(self, 1);
                        }
                      }
                      else {
                        if(complete) complete.call(self, true);
                      }
                  });
                });

                return self;
              }
              else {
                  if(complete) complete.call(self, true);
              }
        };

        /**
         * Upload a binary and install it onto target.
         * @param {string} simulatorOrDevice The device to be upload
         * @param {object} bundleId The bundle identifier
         * @param {string} appPath The path to the application
         * @param {function=} complete A callback for completion
         */
        this.upload = function (simulatorOrDevice, bundleId, appPath, complete) {
            var a = arguments.sodaexpect("string", "string", "string", "function|undefined"), err;

            if(a.error) {
                switch(a.number) {
                    case 0:
                        err = new soda.exception.InvalidArgumentsError("WebDriver.upload is missing argument #" + a.number + ": `simulatorOrDevice`");
                        break;

                    case 1:
                        err = new soda.exception.InvalidArgumentsError("WebDriver.upload is missing argument #" + a.number + ": `bundleId`");
                        break;

                    case 2:
                        err = new soda.exception.InvalidArgumentsError("WebDriver.upload is missing argument #" + a.number + ": `appPath`");
                        break;

                    case 3:
                        err = new soda.exception.InvalidArgumentsError("WebDriver.build is missing argument #" + a.number + ": `complete`");
                        break;
                }
            }

            if(err) {
                if(complete instanceof Function) {
                    complete.call(self, false);
                }
                else {
                    throw err;
                }
            }

            uploadToDevice(simulatorOrDevice, bundleId, appPath, complete);

            return self;
        };

        /**
         * Resets the target simulator.
         * @param {function=} complete A callback for completion
         */
        this.reset = function (complete) {
            var a = arguments.sodaexpect("function|undefined"), err;

            if(a.error) {
                err = new soda.exception.InvalidArgumentsError("Callback required");
            }

            if(err) {
                if(complete instanceof Function) {
                    complete.call(self, false);
                }
                else {
                    throw err;
                }
            }
            exec(
                "pkill iOS\\ Simulator\n" +
                "pkill Simulator\n", function() {
                    var completedCount = 0;
                    self.findDevice(null, function(err, device, available) { // jshint ignore:line
                        if (err) {
                            if(complete) complete.call(self, false);
                        }

                        available.sodaeach(function (d, i) {
                            exec(
                            ("xcrun simctl shutdown " + i + "\n"), function(err, stdout, stderr) { // jshint ignore:line
                                completedCount++;

                                if (completedCount === available.sodamembers-1) {
                                    var xbuild = spawn("xcrun", [
                                        "simctl",
                                        "erase",
                                        "all"
                                    ]);

                                    xbuild.stderr.on('data', function (data) {
                                        soda.console.error(data.toString('utf-8'));
                                    });

                                    xbuild.stdout.on('data', function (data) {
                                        soda.console.verbose(data.toString('utf-8'));
                                    });

                                    if(complete) complete.call(self, true);
                                }
                            });
                        });
                    });
                });
        };

        /**
         * Starts the instruments framework driver
         * @param {string} simulator The device UDID or name to launch on the iOS simulator
         * @param {string} app The app to launch
         * @param {object} bundleId The bundle identifier
         * @param {string|function} testPath The path to the testing directory (defaults to process.cwd())
         * @param {object|function} options Command line flags
         * @param {function} complete A callback for completion
         */
        this.start = function (simulator, app, bundleId, testPath, options, complete) {
            if(!complete &amp;&amp; !options &amp;&amp; testPath instanceof Function) {
                complete = testPath;
                testPath = undefined;
                options  = undefined;
            }

            if(!complete &amp;&amp; options instanceof Function) {
                complete = options;
                options = undefined;
            }

            if(!options &amp;&amp; typeof testPath === "object") {
                options = testPath;
                testPath = undefined;
            }

            var a = arguments.sodaexpect("string", "string", "string", "string|undefined|null|object|function", "object|undefined|null|function", "function|undefined|null");
            if(a.error) {
                switch(a.number) {
                    case 0:
                        throw new soda.exception.InvalidArgumentsError("Instruments.start is missing argument #" + a.number + ": `simulator`");

                    case 1:
                        throw new soda.exception.InvalidArgumentsError("Instruments.start is missing argument #" + a.number + ": `app`");

                    case 2:
                        throw new soda.exception.InvalidArgumentsError("Instruments.start is missing argument #" + a.number + ": `bundleId`");

                    case 3:
                        throw new soda.exception.InvalidArgumentsError("Instruments.start is missing argument #" + a.number + ": `testPath`");

                    case 4:
                        throw new soda.exception.InvalidArgumentsError("Instruments.start is missing argument #" + a.number + ": `options`");

                    case 5:
                        throw new soda.exception.InvalidArgumentsError("Instruments.start is missing argument #" + a.number + ": `complete`");
                }
            }

            var args = arguments.sodaToArray;

            uploadToDevice(simulator, bundleId, app, function(err, instruments) {
              args.pop(); // Pop off the callback

              instance = {
                  process : instruments,
                  running : true,
                  args    : args
              };

              bundleIdentifier = bundleId;

              complete.call(self, null, true);
            });
        };

        /**
         * Stop the instruments framework
         * @param {function} complete A callback for completion
         */
        this.stop = function (complete) {
            if(!instance || (instance &amp;&amp; instance.running === false)) {
                if(complete) complete.call(self, true);
                soda.console.debug("Instruments: Framework stopped");
                return;
            }

            var err = arguments.sodaexpect("function|undefined").error;

            if(err) throw err;

            exec(
                "pkill xcodebuild\n",
                function () {
                    setTimeout(function () {
                        instance = {
                            process: null,
                            running: false,
                            args   : null
                        };
                        soda.console.debug("Instruments: Framework stopped");
                        complete.call(self, null, true);
                    }, 3000);
                }
            );
        };

        /**
         * Restarts the app
         * If stopped, an error will be returned in the callback
         * @param {function} complete A callback for completion
         */
        this.restartApplication = function (complete) {
            driver.stopApplication(function (err, result) {
              return driver.startApplication(bundleIdentifier, complete);
            });
        };

        /**
         * Restarts the instruments framework
         * If stopped, an error will be returned in the callback
         * @param {function} complete A callback for completion
         */
        this.restart = function (complete) {
            var err = arguments.sodaexpect("function|undefined").error,
                args;

            if(err) {
                if(complete instanceof Function) complete.call(self, err, null);
            }
            else if(instance.process &amp;&amp; instance.running === true) {
                args = instance.args;
                args.push(complete);
                self.stop(function () { self.start.apply(self, args); });
            }
            else {
                if(complete) complete.call(null, new Error("Cannot restart, since Instruments isn't running."), null);
            }
            return self;
        };

        /**
         * Searches the Device PList Directory in parallel and looks for a device match
         * @param {string} device The device name in the format `[name] [runtime]` or the device UDID
         * @param {function} complete A callback for completion, with provided arguments [error, device, device list]
         */
        function checkIsSimulator (device, complete) {
            var err = arguments.sodaexpect("object", "function|undefined").error;
            if(err) throw err;

            var file = nodePath.join(soda.config.get("userHome"), iconfig['DEVICE_PLIST_DIR'], device.udid, "device.plist");

            console.log(file);
            fs.stat(file, function (err, stat) {
                if(err) {
                    complete.call(self, false);
                    return;
                }
                else if(stat &amp;&amp; stat.isFile() === true) {
                    complete.call(self, true);
                }
            });
        }

        /**
         * Lists all available devices
         * @param  {Function} done A callback for completion
         * @return {Instruments} The current Instruments instance
         */
        this.listAvailableDevices = function (done) {
            var devices = [];
            self.findDevice(null, function (err, device, available) {
                if(available &amp;&amp; typeof available === "object") {
                    available.sodaeach(function (d) { devices.push(d.name + (d.runtime ? (" " + d.runtime) : "")); });
                }
                if(done instanceof Function) done.call(self, devices);
            });
            return self;
        };

        /**
         * Uses the `instruments -s device` command to locate either simulator or physical devices
         * @param {string} requestedDevice The device name in the format `[name] [runtime]` or the device UDID
         * @param {function} complete A callback for completion, with provided arguments [error, device, device list]
         */
        this.findDevice = function (requestedDevice, complete) {
            exec("instruments -s devices", function (err, stdout) {
                var available = {};

                if(err) {
                    complete.call(self, err, null, null);
                }
                else {
                    var devices = stdout
                        .replace(/Known Templates:\n[\s\S]*/, '')
                        .replace(/Known Devices:\n/, '').split('\n')
                        .toTruthy;

                    devices.sodaeach(function (device) {
                        var m = device.match(/([a-zA-Z0-9 ]+?) (?:(?:\((.*?)(?: Simulator)?\) )?)\[(.*)]/);

                        if(m) {
                            var deviceName = m[1],
                                deviceUDID = m[3],
                                deviceOS   = m[2] || null;

                            available[deviceUDID] = {
                                name        : deviceName,
                                udid        : deviceUDID,
                                runtime     : deviceOS
                            };
                        }
                    });

                    var foundDevice = null, count = available.sodamembers;
                    available.sodaeach(function (device) {
                        checkIsSimulator(device, function (isSim) {
                            count--;
                            device.isSimulator = !!isSim;
                            if((requestedDevice === device.name + ' ' + device.runtime || requestedDevice === device.udid || requestedDevice === device.name) &amp;&amp; device.runtime.indexOf('Apple Watch') &lt; 0) foundDevice = device;
                            if(count === 0) complete.call(self, null, foundDevice, available);
                        });
                    });
                }
            });
        };

        /**
         * Perform a user interaction on an element in the current DOM-Tree
         * @param {string} interaction The interaction name
         * @param {Array} elems An array of elements
         * @param {object} options Options
         * @param {function=} complete A callback for completion
         */
        this.performElementInteraction = function (interaction, elems, options, complete) {
            var err = arguments.sodaexpect("string", "array|string", "object|string|undefined", "function|undefined").error;
            if(err) throw err;

            if(!options) options = {};
            if(!(elems instanceof Array)) elems = [elems];

            var elemIds = [];
            elems.sodaeach(function (e) {
                elemIds.push(e.id);
            });

            switch(interaction) {
              case "setValue":
                  return elementInteractions.setValue(elems, options, complete);

              case "tap":
                  elementInteractions.tap(elems, options, function(err, result) {
                    setTimeout(function() {
                      if(complete) complete.call(self, err, result);
                    }, 2000);
                  });
                  break;

              case "scroll":
                  elementInteractions.scroll(elems, options, function(err, result) {
                    setTimeout(function() {
                      if(complete) complete.call(self, err, result);
                    }, 2000);
                  });
                  break;

                case "scrollToVisible":
                    options.count = 1;
                    elementInteractions.scrollToVisible(elems, options, function(err, result) {
                      setTimeout(function() {
                        if(driver) {
                          driver.getSourceTree(function(err, result) {
                              var iTree = null;

                              if (result.XCUIElementTypeApplication) {
                                iTree = Tree.buildTree(result, {});

                                var theElements = Tree.getElements();

                                if (elems[0] &amp;&amp; theElements[elems[0].id]) {
                                  if (theElements[elems[0].id].visible) {
                                    if(complete) complete.call(self, err, result);
                                  }
                                  else {
                                    if (options.count &lt; 5) {
                                      options.count = options.count++;
                                      self.performElementInteraction(interaction, elems, options, complete);
                                    }
                                    else {
                                      if(complete) complete.call(self, err, result);
                                    }
                                  }
                                }
                                else {
                                    if(complete) complete.call(self, err, result);
                                }
                              }
                              else {
                                if (complete) complete(null, false);
                              }
                              return iTree;
                            });
                        }
                        else {
                            if(complete instanceof Function)
                                complete(new Error("Cannot get element tree, since the driver hasn't been started yet."), false);
                        }
                      }, 2000);
                    });
                    break;

              default:
                  if(complete instanceof Function) complete(new Error("Unknown element interaction `" + interaction + "`"), null);
            }
        };

        /**
         * Perform a user interaction on an element in the current DOM-Tree
         * @param {string} interaction The interaction name
         * @param {object} options Options to pass onto Instruments
         * @param {function=} complete A callback for completion
         */
        this.performDeviceInteraction = function (interaction, options, complete) {
            var err = arguments.sodaexpect("string", "object|string|undefined", "function|undefined").error;

            if(err) {
                if(complete) complete.call(self, err, false);
                return;
            }

            if(driver) {
                switch(interaction) {
                    case "startApp":
                        return driver.startApplication(options.path === appName ? bundleIdentifier : options.path, complete);

                    case "openApp":
                        return driver.startApplication(options.path === appName ? bundleIdentifier : options.path, complete);

                    case "closeApp":
                        return driver.stopApplication(complete);

                    case "stopApp":
                        return driver.stopApplication(complete);

                    case "homeScreen":
                        return driver.home(options, complete);

                    case "lockScreen":
                        return driver.lock(options, complete);

                    case "captureScreen":
                        return driver.takeScreenshot(options, complete);

                    case "tapXY":
                        return driver.tapXY(options, complete);

                    case "typeOnKeyboard":
                        return driver.typeOnKeyboard(options.string, complete);

                    case "scroll window":
                        return driver.scrollScreen(options, complete);

                    case "deviceSwipe":
                        return driver.swipe(options, complete);

                    case "resetAppData":
                        return driver.resetAppData(complete);

                    default:
                        if(complete instanceof Function) complete(new Error("Unsupported or unknown device interaction `" + interaction + "`"), null);
                }
            }
            else {
                if(complete instanceof Function)
                    complete(new Error("Cannot perform device interaction, since the driver hasn't been started yet."), false);
            }

            return self;
        };

        /**
         * Gets the DOM tree from Instruments. First it sends a request to build the tree to instruments, then when instruments
         * responds, it calls the completion callback with the results.
         * @param {{}|function} options Options to pass to instruments
         * @param {function=} complete A callback for completion
         */
        this.getTree = function (options, complete) {
          if(!complete &amp;&amp; options instanceof Function) {
              complete     = options;
              options  = undefined;
          }

          if(driver) {
            driver.getSourceTree(function(err, result) {
                var iTree = null;

                if (result.XCUIElementTypeApplication) {
                  if (!appName) {
                    appName = result.XCUIElementTypeApplication.$.name;
                    console.log("Stored appName as:", appName);
                  }

                  iTree = Tree.buildTree(result, {});

                  if (iTree === false) {
                    if (complete) complete(new Error("Could not get tree from Instruments"), false);
                  }

                  if (complete) complete(null, iTree);
                }
                else {
                  if (complete) complete(null, false);
                }
                return iTree;
              });
          }
          else {
              if(complete instanceof Function)
                  complete(new Error("Cannot get element tree, since the driver hasn't been started yet."), false);
          }

          return self;
        };

        /**
         * Gets the device orientation&lt;br>
         * Results will be an integer 0 - 6, according to:
         * https://developer.apple.com/library/prerelease/ios/documentation/ToolsLanguages/Reference/UIATargetClassReference/index.html#//apple_ref/doc/uid/TP40009924-CH3-DontLinkElementID_4
         * @param {function} complete A callback for completion
         */
        this.getOrientation = function (complete) {
            getOrientation(function (err, orientation) {
                if(err) {
                    if(complete) complete.call(self, err, null);
                    return;
                }

                var orientationValue = 0;

                switch (orientation) {
                  case "PORTRAIT":
                    orientationValue = 1;
                    break;
                  case "UIA_DEVICE_ORIENTATION_PORTRAIT_UPSIDEDOWN":
                    orientationValue = 2;
                    break;
                  case "LANDSCAPE":
                    orientationValue = 3;
                    break;
                  case "UIA_DEVICE_ORIENTATION_LANDSCAPERIGHT":
                    orientationValue = 4;
                    break;
                  case "UIA_DEVICE_ORIENTATION_FACEUP":
                    orientationValue = 5;
                    break;
                  case "UIA_DEVICE_ORIENTATION_FACEDOWN":
                    orientationValue = 6;
                    break;
                }

                if(complete) complete.call(self, err, orientationValue);
            });
        };

        /**
         * Gets the device's screen bounds&lt;br>
         * @param {function} complete A callback for completion
         */
        this.getScreenBounds = function (complete) {
          getScreenBounds(function (err, contents) {
              if(err) {
                  if(complete) complete.call(self, err, null);
                  return;
              }
              if(complete) complete.call(self, err, contents);
          });
        };

        /**
         * Returns whether it is a simulator &lt;br>
         * @param {boolean} result A boolean for the result
         */
        this.isDeviceASimulator = function () {
          return this.isSimulator;
        };
    };

    return Object.freeze(new Instruments (soda));
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Automator.html">Automator</a></li><li><a href="module-Automator_BuildTree.html">Automator/BuildTree</a></li><li><a href="module-Automator_Configuration.html">Automator/Configuration</a></li><li><a href="module-Automator_DeviceInteractions.html">Automator/DeviceInteractions</a></li><li><a href="module-Automator_ElementInteractions.html">Automator/ElementInteractions</a></li><li><a href="module-Automator_EmulatorControl.html">Automator/EmulatorControl</a></li><li><a href="module-Engine_Syntaxes_Mobile.html">Engine/Syntaxes/Mobile</a></li><li><a href="module-Engine_Syntaxes_Mobile_Functions.html">Engine/Syntaxes/Mobile/Functions</a></li><li><a href="module-Engine_Syntaxes_Mobile_Syntax.html">Engine/Syntaxes/Mobile/Syntax</a></li><li><a href="module-Engine_Syntaxes_Web.html">Engine/Syntaxes/Web</a></li><li><a href="module-Engine_Syntaxes_Web_Functions.html">Engine/Syntaxes/Web/Functions</a></li><li><a href="module-Engine_Syntaxes_Web_Syntax.html">Engine/Syntaxes/Web/Syntax</a></li><li><a href="module-Instruments.html">Instruments</a></li><li><a href="module-Instruments_Configuration.html">Instruments/Configuration</a></li><li><a href="module-Instruments_DeviceInteractions.html">Instruments/DeviceInteractions</a></li><li><a href="module-Instruments_ElementInteractions.html">Instruments/ElementInteractions</a></li><li><a href="module-Instruments_IO.html">Instruments/IO</a></li><li><a href="module-Perfecto.html">Perfecto</a></li><li><a href="module-Perfecto_Configuration.html">Perfecto/Configuration</a></li><li><a href="module-Perfecto_Driver.html">Perfecto/Driver</a></li><li><a href="module-Perfecto_ElementInteractions.html">Perfecto/ElementInteractions</a></li><li><a href="module-Rest.html">Rest</a></li><li><a href="module-Rest_Configuration.html">Rest/Configuration</a></li><li><a href="module-Rest_Driver.html">Rest/Driver</a></li><li><a href="module-Selenium.html">Selenium</a></li><li><a href="module-Selenium_Configuration.html">Selenium/Configuration</a></li><li><a href="module-Selenium_Driver.html">Selenium/Driver</a></li><li><a href="module-Shell.html">Shell</a></li><li><a href="module-VisualEditorLauncher.html">VisualEditorLauncher</a></li><li><a href="module-Windows.html">Windows</a></li><li><a href="module-Windows_Configuration.html">Windows/Configuration</a></li><li><a href="module-Windows_Driver.html">Windows/Driver</a></li><li><a href="module-Soda_AssetCollection.html">Soda/AssetCollection</a></li><li><a href="module-Soda_AssetDrivers_FileSystem.html">Soda/AssetDrivers/FileSystem</a></li><li><a href="module-Soda_EvalSafe.html">Soda/EvalSafe</a></li><li><a href="module-Soda_StaticServer.html">Soda/StaticServer</a></li><li><a href="module-Sodac.html">Sodac</a></li><li><a href="module-SodaCommon_Config.html">SodaCommon/Config</a></li><li><a href="module-SodaCommon_Console.html">SodaCommon/Console</a></li><li><a href="module-SodaCommon_Cypher.html">SodaCommon/Cypher</a></li><li><a href="module-SodaCommon_Exception.html">SodaCommon/Exception</a></li><li><a href="module-SodaCommon_Exec.html">SodaCommon/Exec</a></li><li><a href="module-SodaCommon_ProtoLib.html">SodaCommon/ProtoLib</a></li><li><a href="module-SodaCore_ActionManager.html">SodaCore/ActionManager</a></li><li><a href="module-SodaCore_Asset.html">SodaCore/Asset</a></li><li><a href="module-SodaCore_AssetDrivers_Database.html">SodaCore/AssetDrivers/Database</a></li><li><a href="module-SodaCore_Assets.html">SodaCore/Assets</a></li><li><a href="module-SodaCore_AssetTypes.html">SodaCore/AssetTypes</a></li><li><a href="module-SodaCore_CoreSyntax.html">SodaCore/CoreSyntax</a></li><li><a href="module-SodaCore_DeviceInteractions.html">SodaCore/DeviceInteractions</a></li><li><a href="module-SodaCore_ElementInteractions.html">SodaCore/ElementInteractions</a></li><li><a href="module-SodaCore_Framework.html">SodaCore/Framework</a></li><li><a href="module-SodaCore_Module.html">SodaCore/Module</a></li><li><a href="module-SodaCore_Platform.html">SodaCore/Platform</a></li><li><a href="module-SodaCore_Run.html">SodaCore/Run</a></li><li><a href="module-SodaCore_Suite.html">SodaCore/Suite</a></li><li><a href="module-SodaCore_Syntax.html">SodaCore/Syntax</a></li><li><a href="module-SodaCore_TestRunner.html">SodaCore/TestRunner</a></li><li><a href="module-SodaCore_Trace.html">SodaCore/Trace</a></li><li><a href="module-SodaCore_Tree.html">SodaCore/Tree</a></li><li><a href="module-SodaCore_Vars.html">SodaCore/Vars</a></li><li><a href="module-SodaCore_Soda.html">SodaCore/Soda</a></li><li><a href="module-SodaREPL_Commands.html">SodaREPL/Commands</a></li><li><a href="module-SodaREPL_REPL.html">SodaREPL/REPL</a></li><li><a href="module-SodaREPL_StdLib.html">SodaREPL/StdLib</a></li><li><a href="module-SodaVisualEditor_Server.html">SodaVisualEditor/Server</a></li><li><a href="module-SodaVisualEditor_VisualEditorEvents.html">SodaVisualEditor/VisualEditorEvents</a></li><li><a href="PoductsAndRates_Emailer%250AAn%2520emailer%2520class.%2520Performs%2520operations%2520against%2520the%2520SMTP%2520server.module_.html">PoductsAndRates/Emailer
An emailer class. Performs operations against the SMTP server.</a></li></ul><h3>Classes</h3><ul><li><a href="BaseDriver.html">BaseDriver</a></li><li><a href="ExtClass.html">ExtClass</a></li><li><a href="module.SodaCommon_Exception.Exception.SodaError.html">SodaError</a></li><li><a href="module.SodaCore_Tree.TreeWrapper.Tree.html">Tree</a></li><li><a href="module-Automator_DeviceInteractions-DeviceInteractions.html">DeviceInteractions</a></li><li><a href="module-Automator_ElementInteractions-ElementInteractions.html">ElementInteractions</a></li><li><a href="module-Automator_EmulatorControl-EmulatorControl.html">EmulatorControl</a></li><li><a href="module-Automator-Automator.html">Automator</a></li><li><a href="module-Instruments-Instruments.html">Instruments</a></li><li><a href="module-Perfecto_Driver-PerfectoDriver.html">PerfectoDriver</a></li><li><a href="module-Perfecto_Driver-WebDriver.html">WebDriver</a></li><li><a href="module-Perfecto_ElementInteractions-ElementInteractions.html">ElementInteractions</a></li><li><a href="module-Perfecto-Perfecto.html">Perfecto</a></li><li><a href="module-Rest_Driver-RestDriver.html">RestDriver</a></li><li><a href="module-Rest-Rest.html">Rest</a></li><li><a href="module-Selenium_Driver-SeleniumDriver.html">SeleniumDriver</a></li><li><a href="module-Selenium-Selenium.html">Selenium</a></li><li><a href="module-Shell-Shell.html">Shell</a></li><li><a href="module-Windows_Driver-WindowsDriver.html">WindowsDriver</a></li><li><a href="module-Windows-Windows.html">Windows</a></li><li><a href="module-Soda_AssetCollection-AssetCollection.html">AssetCollection</a></li><li><a href="module-Soda_AssetDrivers_FileSystem-FileSystem.html">FileSystem</a></li><li><a href="module-SodaCommon_Config-SodaConfig.html">SodaConfig</a></li><li><a href="module-SodaCommon_Console-Console.html">Console</a></li><li><a href="module-SodaCore_ActionManager-Action.html">Action</a></li><li><a href="module-SodaCore_AssetDrivers_Database-Database.html">Database</a></li><li><a href="module-SodaCore_Assets-Assets.html">Assets</a></li><li><a href="module-SodaCore_AssetTypes.Action.html">Action</a></li><li><a href="module-SodaCore_AssetTypes.Menu.html">Menu</a></li><li><a href="module-SodaCore_AssetTypes.Popup.html">Popup</a></li><li><a href="module-SodaCore_AssetTypes.Screen.html">Screen</a></li><li><a href="module-SodaCore_AssetTypes.Test.html">Test</a></li><li><a href="module-SodaCore_Asset-Asset.html">Asset</a></li><li><a href="module-SodaCore_DeviceInteractions-DeviceInteractions.html">DeviceInteractions</a></li><li><a href="module-SodaCore_ElementInteractions-ElementInteractions.html">ElementInteractions</a></li><li><a href="module-SodaCore_Framework-Framework.html">Framework</a></li><li><a href="module-SodaCore_Module-Module.html">Module</a></li><li><a href="module-SodaCore_Platform-Platform.html">Platform</a></li><li><a href="module-SodaCore_Run-Run.html">Run</a></li><li><a href="module-SodaCore_Suite-Suite.html">Suite</a></li><li><a href="module-SodaCore_Syntax-Syntax.html">Syntax</a></li><li><a href="module-SodaCore_TestRunner-TestRunner.html">TestRunner</a></li><li><a href="module-SodaCore_Trace-Trace.html">Trace</a></li><li><a href="module-SodaCore_Vars-Vars.html">Vars</a></li><li><a href="module-SodaCore_Soda-Soda.html">Soda</a></li><li><a href="module-SodaREPL_REPL-REPL.html">REPL</a></li><li><a href="module-SodaVisualEditor_Server-Server.html">Server</a></li><li><a href="module-SodaVisualEditor_VisualEditorEvents-PseduoAction.html">PseduoAction</a></li><li><a href="PoductsAndRates_Emailer%250AAn%2520emailer%2520class.%2520Performs%2520operations%2520against%2520the%2520SMTP%2520server.module_-Emailer.html">Emailer</a></li><li><a href="SuperRoot.html">SuperRoot</a></li><li><a href="window.SodaActionManager.html">SodaActionManager</a></li><li><a href="window.SodaConsole.html">SodaConsole</a></li><li><a href="window.SodaDelegates.html">SodaDelegates</a></li><li><a href="window.SodaEditor.html">SodaEditor</a></li><li><a href="window.SodaEmitter.html">SodaEmitter</a></li><li><a href="window.SodaFramework.html">SodaFramework</a></li><li><a href="window.SodaNamespace.SodaDependency.html">SodaDependency</a></li><li><a href="window.SodaNamespace.SodaStartupSetting.html">SodaStartupSetting</a></li><li><a href="window.SodaNamespace.SodaVisualEditor.html">SodaVisualEditor</a></li><li><a href="window.SodaProjectManager.html">SodaProjectManager</a></li><li><a href="window.SodaRunner.html">SodaRunner</a></li><li><a href="window.SodaScreen.html">SodaScreen</a></li><li><a href="window.SodaTestEditor.html">SodaTestEditor</a></li><li><a href="window.SodaTree.html">SodaTree</a></li></ul><h3>Events</h3><ul><li><a href="module.SodaCommon_Config.SodaConfig.html#event:configget">config get</a></li><li><a href="module.SodaCommon_Config.SodaConfig.html#event:configset">config set</a></li><li><a href="module.SodaCommon_Console.Console.html#event:log">log</a></li><li><a href="module.SodaCommon_Console.Console.html#event:postlog">post log</a></li><li><a href="module.SodaCommon_Console.Console.html#event:prelog">pre log</a></li><li><a href="module.SodaCore.Tree.TreeWrapper.Tree.html#event:buildingelement">building element</a></li><li><a href="module.SodaCore_Framework.Framework.html#event:build">build</a></li><li><a href="module.SodaCore_Framework.Framework.html#event:exited">exited</a></li><li><a href="module.SodaCore_Framework.Framework.html#event:getorientation">get orientation</a></li><li><a href="module.SodaCore_Framework.Framework.html#event:getscreenbounds">get screen bounds</a></li><li><a href="module.SodaCore_Framework.Framework.html#event:gotorientation">got orientation</a></li><li><a href="module.SodaCore_Framework.Framework.html#event:gotscreenbounds">got screen bounds</a></li><li><a href="module.SodaCore_Framework.Framework.html#event:load">load</a></li><li><a href="module.SodaCore_Framework.Framework.html#event:performeddeviceinteraction">performed device interaction</a></li><li><a href="module.SodaCore_Framework.Framework.html#event:performedelementinteraction">performed element interaction</a></li><li><a href="module.SodaCore_Framework.Framework.html#event:postbuild">post build</a></li><li><a href="module.SodaCore_Framework.Framework.html#event:restart">restart</a></li><li><a href="module.SodaCore_Framework.Framework.html#event:restarted">restarted</a></li><li><a href="module.SodaCore_Framework.Framework.html#event:start">start</a></li><li><a href="module.SodaCore_Framework.Framework.html#event:started">started</a></li><li><a href="module.SodaCore_Framework.Framework.html#event:stop">stop</a></li><li><a href="module.SodaCore_Framework.Framework.html#event:stopped">stopped</a></li><li><a href="module.SodaCore_Syntax.Syntax.html#event:define">define</a></li><li><a href="module.SodaCore_TestRunner.TestRunner.html#event:init">init</a></li><li><a href="module.SodaCore_TestRunner.TestRunner.html#event:moduleresults">module results</a></li><li><a href="module.SodaCore_TestRunner.TestRunner.html#event:results">results</a></li><li><a href="module.SodaCore_TestRunner.TestRunner.html#event:starttest">start test</a></li><li><a href="module.SodaCore_TestRunner.TestRunner.html#event:suiteresults">suite results</a></li><li><a href="module.SodaCore_Vars.Vars.html#event:delete">delete</a></li><li><a href="module.SodaCore_Vars.Vars.html#event:empty">empty</a></li><li><a href="module.SodaCore_Vars.Vars.html#event:get">get</a></li><li><a href="module.SodaCore_Vars.Vars.html#event:save">save</a></li><li><a href="module.SodaCore_Soda.Soda.html#event:sodainitialized">soda initialized</a></li><li><a href="module.SodaCore_Soda.Soda.html#event:sodakilled">soda killed</a></li><li><a href="module.SodaCore_Soda.Soda.html#event:sodatempcleaned">soda temp cleaned</a></li><li><a href="module.SodaREPL_REPL.REPL.html#event:close">close</a></li><li><a href="module.SodaREPL_REPL.REPL.html#event:closed">closed</a></li><li><a href="module.SodaREPL_REPL.REPL.html#event:commandnotfound">command not found</a></li><li><a href="module.SodaREPL_REPL.REPL.html#event:gotsigint">got sigint</a></li><li><a href="module.SodaREPL_REPL.REPL.html#event:line">line</a></li><li><a href="Run.html#event:allow">allow</a></li><li><a href="Run.html#event:current">current</a></li><li><a href="Run.html#event:failed">failed</a></li><li><a href="Run.html#event:paused">paused</a></li><li><a href="Run.html#event:running">running</a></li><li><a href="Run.html#event:stopped">stopped</a></li><li><a href="window.SodaDelegates.html#event:%255Bfiltertitle%255D">[filter title]</a></li><li><a href="window.SodaDelegates.html#event:%255Bfiltertitle%255Dafter">[filter title] after</a></li><li><a href="window.SodaDelegates.html#event:%255Bfiltertitle%255Dbefore">[filter title] before</a></li><li><a href="window.SodaDelegates.html#event:%255Bsearchtitle%255Dafter">[search title] after</a></li><li><a href="window.SodaDelegates.html#event:%255Bsearchtitle%255Dbefore">[search title] before</a></li><li><a href="window.SodaDelegates.html#event:change%255Btabgroup%255D">change [tab group]</a></li><li><a href="window.SodaDelegates.html#event:postshow%255Btabgroup%255D">post show [tab group]</a></li><li><a href="window.SodaNamespace_SodaVisualEditor.html#event:dependenciesloaded">dependencies loaded</a></li><li><a href="window.SodaNamespace_SodaVisualEditor.html#event:editorinit">editor init</a></li><li><a href="window.SodaNamespace_SodaVisualEditor.html#event:editorshowing">editor showing</a></li><li><a href="window.SodaNamespace_SodaVisualEditor.html#event:editorshown">editor shown</a></li><li><a href="window.SodaNamespace_SodaVisualEditor.html#event:frameworkinitialized">framework initialized</a></li><li><a href="window.SodaNamespace_SodaVisualEditor.html#event:frameworkstarted">framework started</a></li><li><a href="window.SodaNamespace_SodaVisualEditor.html#event:frameworkstartuperror">framework startup error</a></li><li><a href="window.SodaNamespace_SodaVisualEditor.html#event:frameworkstopped">framework stopped</a></li></ul><h3>Namespaces</h3><ul><li><a href="Assert.html">Assert</a></li><li><a href="Instruments_Simulator.html">Instruments/Simulator</a></li><li><a href="Instruments_Tree.html">Instruments/Tree</a></li><li><a href="module-Automator_Configuration-AutomatorConfiguration.html">AutomatorConfiguration</a></li><li><a href="module-Instruments_Configuration-InstrumentsConfiguration.html">InstrumentsConfiguration</a></li><li><a href="module-Perfecto_Configuration-PerfectoConfiguration.html">PerfectoConfiguration</a></li><li><a href="module-Rest_Configuration-SeleniumConfiguration.html">SeleniumConfiguration</a></li><li><a href="module-Selenium_Configuration-SeleniumConfiguration.html">SeleniumConfiguration</a></li><li><a href="module-Windows_Configuration-WindowsConfiguration.html">WindowsConfiguration</a></li><li><a href="module-SodaCommon_Exception-Exception.html">Exception</a></li><li><a href="Perfecto_iOSTree.html">Perfecto/iOSTree</a></li></ul><h3>Global</h3><ul><li><a href="global.html#buildTree">buildTree</a></li><li><a href="global.html#splice">splice</a></li><li><a href="global.html#Vars">Vars</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Wed Mar 07 2018 21:52:56 GMT-0500 (EST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
